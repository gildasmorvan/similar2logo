<fieldset>
  <div id="result_div" style="text-align:center"></div>
</fieldset>
<canvas id='grid_canvas' ondblclick='fullScreen();' class='center-block' width='800' height='800'></canvas>
<div class="row">
    <div class="col"id='distance_chart'></div>
	<div class="col" id='angle_chart'></div>
	<div class="col" id='speed_chart'></div>
	<div class="col" id='acceleration_chart'></div>
</div>
<script type='text/javascript'>
	var result = new WebSocket("ws://" + location.hostname + ":" + location.port + "/result");
	$(function () {
    $('[data-toggle=\popover\]').popover();
        result.onmessage = function (event) {
            document.getElementById("result_div").innerHTML = "<h2>"+event.data+"</h2>";
        }
});
</script>
<script type='text/javascript'>
	$(document).ready(function () {
		g1 = new Dygraph(
			document.getElementById('distance_chart'),
			'distance.txt',
			{ 
				height:200,
				showRoller: false,
				customBars: false,
				labels: ['Time', 'Distance'],
				legend: 'always',
				labelsSeparateLines: true,
				title: 'Distance to goal',
				keepXAxis:true,
				keepYAxis:true,
				logscale: true
			}
		);
		g2 = new Dygraph(
			document.getElementById('angle_chart'),
			'angle.txt',
			{ 
				height:200,
				showRoller: false,
				customBars: false,
				labels: ['Time', 'Angle'],
				legend: 'always',
				labelsSeparateLines: true,
				title: 'Angle to goal',
				keepXAxis:true,
				keepYAxis:true
			}
		);
		g3 = new Dygraph(
			document.getElementById('speed_chart'),
			'speed.txt',
			{ 
				height:200,
				showRoller: false,
				customBars: false,
				labels: ['Time', 'Speed'],
				legend: 'always',
				labelsSeparateLines: true,
				title: 'Speed',
				keepXAxis:true,
				keepYAxis:true
			}
		);
		g4 = new Dygraph(
			document.getElementById('acceleration_chart'),
			'acceleration.txt',
			{ 
				height:200,
				showRoller: false,
				customBars: false,
				labels: ['Time', 'Acceleration'],
				legend: 'always',
				labelsSeparateLines: true,
				title: 'Acceleration',
				keepXAxis:true,
				keepYAxis:true
			}
		);
		setInterval(
			function() {
				g1.updateOptions( { 'file': 'distance.txt' } );
				g2.updateOptions( { 'file': 'angle.txt' } );
				g3.updateOptions( { 'file': 'speed.txt' } );
				g4.updateOptions( { 'file': 'acceleration.txt' } );
			},
			20
		);
	});
</script>
<script type='text/javascript'>
    drawCanvas = function (data) {
       var json = JSON.parse(data),
           canvas = document.getElementById('grid_canvas'),
           context = canvas.getContext('2d');
       context.clearRect(0, 0, canvas.width, canvas.height);


        for (i = 0; i < json.marks.length; i++) {
            var centerX = json.marks[i].x * canvas.width,
                centerY = (1-json.marks[i].y) * canvas.height,
                radius = 15;

            if (json.marks[i].t == 'goal') context.fillStyle = 'red';
            
            if (json.marks[i].t == 'obstacle') context.fillStyle = 'black';

            context.beginPath();
            context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
            context.fill();
        }

        for (var i = 0; i < json.agents.length; i++) {
            var centerX = json.agents[i].x * canvas.width;
            var centerY = (1-json.agents[i].y) * canvas.height;
            var radius = 4;
            if (json.agents[i].t == 'c') {
                context.fillStyle = 'blue';
            }
            context.beginPath();
            context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
            context.fill();
        }
    }
</script>