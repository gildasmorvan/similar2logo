<canvas id='grid_canvas' class='center-block' width='600' height='600' moz-opaque ></canvas>
<script type='text/javascript'>
    function getRandomColor() {
  		var letters = '0123456789ABCDEF';
  		var color = '#';
  		for (var i = 0; i < 6; i++) {
    		color += letters[Math.floor(Math.random() * 16)];
  		}
  		return color;
	}
	
	var audio = new Audio('takeoff.mp3');
	
   /**
 	* Starts the simulation.
	*/
	function startSimulation() {
    	$.get('start');
    	
    audio.play(audio);
	}
	
    drawCanvas = function (data) {
        var json = JSON.parse(data),
            canvas = document.getElementById('grid_canvas'),
            context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);
		var col = getRandomColor();
       if (json.hasOwnProperty('marks')) {
			for (i = 0; i < json.marks.length; i++) {
				centerX = json.marks[i].x * canvas.width;
				centerY = (1-json.marks[i].y) * canvas.height;
				radius = 1;
			   
				context.fillStyle = col;
				context.beginPath();
				context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
				context.fill();
			}
			
		}
		if (json.hasOwnProperty('agents')) {
			for (i = 0; i < json.agents.length; i++) {
					centerX = json.agents[i].x * canvas.width;
					centerY = (1-json.agents[i].y) * canvas.height;
					
					if (json.agents[i].t == 'rocket') {
						radius = 5;
						context.fillStyle = col;
						context.beginPath();
						context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
						context.fill();
					} else if (json.agents[i].t == 'frag') {
						radius = 2;
						context.fillStyle = col;
						context.beginPath();
						context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
						context.fill();
					}
			}    
		}
    }
</script>