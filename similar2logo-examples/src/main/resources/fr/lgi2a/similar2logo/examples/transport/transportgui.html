<canvas id='grid_canvas' class='center-block' width='1105' height='667'></canvas>

<script type='text/javascript'>
var map;
var webSocketMap = new WebSocket("ws://" + location.hostname + ":" + location.port + "/webSocketMap");
$(function () {
    $('[data-toggle=\popover\]').popover();
    if (document.getElementById('grid_canvas') !== null) {
        webSocketMap.onmessage = function (event) {
            map = drawMap(event.data);
        }
    }
});
</script>
<script type='text/javascript'>
function drawMap(data) {
    var json = JSON.parse(data),
        canvas = document.getElementById('grid_canvas'),
        context = canvas.getContext('2d'),
        image = new Image();
     context.clearRect(0, 0, canvas.width, canvas.height);
     for (i = 0; i < json.marks.length; i++) {
         var centerX = json.marks[i].x * canvas.width,
             centerY = json.marks[i].y * canvas.height,
             radius = 1;
         if (json.marks[i].t == 'street') {
             context.fillStyle = 'red';
         }
         if (json.marks[i].t == 'railway') {
             context.fillStyle = 'orange';
         }
         if (json.marks[i].t == 'station') {
         	context.fillStyle = 'blue'
         	radius = 3
         }
         if (json.marks[i].t == 'tramway') {
         	context.fillStyle = 'purple'
         }
         if (json.marks[i].t == 'tram_stop') {
         	context.fillStyle = 'yellow'
         	radius = 3
         }
         if (json.marks[i].t == 'bus_stop') {
        	 context.fillStyle = 'black'
        	 radius = 3
         }
         context.beginPath();
         context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
         context.fill();
     }
     image.src = canvas.toDataURL("image/png");
 	return image;
 }
</script>
<script type='text/javascript'>
    drawCanvas = function (data) {
       var json = JSON.parse(data),
           canvas = document.getElementById('grid_canvas'),
           context = canvas.getContext('2d');
       context.clearRect(0, 0, canvas.width, canvas.height);   
        context.drawImage(map,0,0); 
        for (var i = 0; i < json.agents.length; i++) {
            var centerX = json.agents[i].x * canvas.width;
            var centerY = json.agents[i].y * canvas.height;
            var radius = 0;
            switch(json.agents[i].t) {
            		case 'train':
            			context.fillStyle = 'blue';
               		radius = 2.5;
               		break;
               	case 'tram':
               		context.fillStyle = 'yellow';
            			radius = 2.5;
            			break;
            		case 'car':
            			context.fillStyle = 'green';
            			radius = 2.5;
            			break;
            		case 'bike':
            			context.fillStyle = 'white';
            			radius = 1.8;
            			break;
            		case 'person':
            			context.fillStyle = 'pink';
            			radius = 1.6;
            			break;
            		case 'wagon':
            			context.fillStyle = 'black' ;
            			radius = 1.2 ;
            			break;
            		case 'bus':
            			context.fillStyle = 'purple';
            			radius = 2.5;
            			break;	
            }
            context.beginPath();
            context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
            context.fill();
        }
    }
</script>